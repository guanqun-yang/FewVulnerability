import os
import re
import pathlib
import itertools
import subprocess

import numpy as np

from utils.common import remove_directories

os.environ["CUDA_VISIBLE_DEVICES"] = "0"
os.environ['MKL_SERVICE_FORCE_INTEL'] = str(1)

category = "memc"
train_valid_same_size = True

remove_directories(["hpo/"])
for prop, info_frac in itertools.product([0.10],
                                         [None]):
    
    prop = round(prop, 2)
    for run in range(1, 11):
        os.environ["CATEGORY"] = category
        os.environ["PROP"] = str(prop)
        os.environ["INFO_FRAC"] = str(info_frac)
        os.environ["TRAIN_VALID_SAME_SIZE"] = str(train_valid_same_size)
        os.environ["RUN"] = str(run)

        command = "python pretrain.py"
        subprocess.run(re.split(r"\s+", command))
    
    remove_directories(["hpo/"])
